---
import "../styles/style.scss";
import siteData from "../data.json";

export interface Props {
  title?: string;
  description?: string;
}

const {
  title = siteData.company.name,
  description = siteData.company.description,
} = Astro.props;
const { company, navigation } = siteData;
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />

    <!-- Meta -->
    <title>{title}</title>
    <meta name="description" content={description} />

    <!-- Styles -->
    <link rel="stylesheet" href="/css/plugins/bootstrap-grid.css" />
    <link rel="stylesheet" href="/css/plugins/font-awesome.min.css" />
    <link rel="stylesheet" href="/css/plugins/swiper.min.css" />
    <link rel="stylesheet" href="/css/plugins/fancybox.min.css" />
    <link rel="shortcut icon" href={company.favicon} type="image/x-icon" />
  </head>

  <body>
    <!-- wrapper -->
    <div class="mil-wrapper" id="top">
      <!-- cursor -->
      <div class="mil-ball">
        <span class="mil-icon-1">
          <svg viewBox="0 0 128 128">
            <path
              d="M106.1,41.9c-1.2-1.2-3.1-1.2-4.2,0c-1.2,1.2-1.2,3.1,0,4.2L116.8,61H11.2l14.9-14.9c1.2-1.2,1.2-3.1,0-4.2	c-1.2-1.2-3.1-1.2-4.2,0l-20,20c-1.2,1.2-1.2,3.1,0,4.2l20,20c0.6,0.6,1.4,0.9,2.1,0.9s1.5-0.3,2.1-0.9c1.2-1.2,1.2-3.1,0-4.2	L11.2,67h105.5l-14.9,14.9c-1.2,1.2-1.2,3.1,0,4.2c0.6,0.6,1.4,0.9,2.1,0.9s1.5-0.3,2.1-0.9l20-20c1.2-1.2,1.2-3.1,0-4.2L106.1,41.9	z"
            ></path>
          </svg>
        </span>
        <div class="mil-more-text">More</div>
        <div class="mil-choose-text">Сhoose</div>
      </div>
      <!-- cursor end -->

      <!-- preloader -->
      <div class="mil-preloader">
        <div class="mil-preloader-animation">
          <div class="mil-pos-abs mil-animation-1">
            <p class="mil-h3 mil-muted mil-thin">Design</p>
            <p class="mil-h3 mil-muted">Create</p>
            <p class="mil-h3 mil-muted mil-thin">Shape</p>
          </div>
          <div class="mil-pos-abs mil-animation-2">
            <div class="mil-reveal-frame">
              <p class="mil-reveal-box"></p>
              <p class="mil-h3 mil-muted mil-thin">{company.url}</p>
            </div>
          </div>
        </div>
      </div>
      <!-- preloader end -->

      <!-- scrollbar progress -->
      <div class="mil-progress-track">
        <div class="mil-progress"></div>
      </div>
      <!-- scrollbar progress end -->

      <!-- menu -->
      <div class="mil-menu-frame">
        <!-- frame clone -->
        <div class="mil-frame-top">
          <a href="/" class="mil-logo"
            ><img src={company.logo} alt={company.name} /></a
          >
          <div class="mil-menu-btn">
            <span></span>
          </div>
        </div>
        <!-- frame clone end -->
        <div class="container">
          <div class="mil-menu-content">
            <div class="row">
              <div class="col-xl-5">
                <nav class="mil-main-menu" id="swupMenu">
                  <ul>
                    {
                      navigation.main.map((item) => (
                        <li
                          class={`mil-has-children ${item.active ? "mil-active" : ""}`}
                        >
                          <a href={item.url}>{item.name}</a>
                        </li>
                      ))
                    }
                  </ul>
                </nav>
              </div>
              <div class="col-xl-7">
                <div class="mil-menu-right-frame">
                  <div class="mil-animation-in">
                    <div class="mil-animation-frame">
                      <div
                        class="mil-animation mil-position-1 mil-scale"
                        data-value-1="2"
                        data-value-2="2"
                      >
                      </div>
                    </div>
                  </div>
                  <div class="mil-menu-right">
                    <div class="row">
                      <div class="col-lg-8 mil-mb-60">
                        <h6 class="mil-muted mil-mb-30">Projects</h6>
                        <ul class="mil-menu-list">
                          {
                            siteData.projects.map((project) => (
                              <li>
                                <a
                                  href={project.url}
                                  target="_blank"
                                  class="mil-light-soft"
                                >
                                  {project.name}
                                </a>
                              </li>
                            ))
                          }
                        </ul>
                      </div>
                      <div class="col-lg-4 mil-mb-60">
                        <h6 class="mil-muted mil-mb-30">Useful links</h6>
                        <ul class="mil-menu-list">
                          {
                            navigation.legal.map((link) => (
                              <li>
                                <a href={link.url} class="mil-light-soft">
                                  {link.name}
                                </a>
                              </li>
                            ))
                          }
                        </ul>
                      </div>
                    </div>
                    <div class="mil-divider mil-mb-60"></div>
                    <div class="row justify-content-between">
                      <div class="col-lg-4 mil-mb-60">
                        <h6 class="mil-muted mil-mb-30">Kenya</h6>
                        <p class="mil-light-soft">
                          {company.contact.location}
                          <span class="mil-no-wrap"
                            >{company.contact.phone}</span
                          >
                        </p>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- menu end -->

      <!-- curtain -->
      <div class="mil-curtain"></div>
      <!-- curtain end -->

      <!-- frame -->
      <div class="mil-frame">
        <div class="mil-frame-top">
          <a href="/" class="mil-logo"
            ><img src={company.logo} alt={company.name} /></a
          >
          <div class="mil-menu-btn">
            <span></span>
          </div>
        </div>
        <div class="mil-frame-bottom">
          <div class="mil-current-page"></div>
          <div class="mil-back-to-top">
            <a href="#top" class="mil-link mil-dark mil-arrow-place">
              <span>Back to top</span>
            </a>
          </div>
        </div>
      </div>
      <!-- frame end -->

      <!-- content -->
      <div class="mil-content">
        <div id="swupMain" class="mil-main-transition">
          <slot />
        </div>
      </div>
      <!-- content end -->

      <!-- footer -->
      <footer class="mil-dark-bg">
        <div class="mi-invert-fix">
          <div class="container mil-p-120-60">
            <div class="row justify-content-between">
              <div class="col-md-4 col-lg-4 mil-mb-60">
                <div class="mil-muted mil-logo mil-up mil-mb-30">
                  {company.name}.
                </div>
                <p class="mil-light-soft mil-up mil-mb-30">
                  Subscribe our newsletter:
                </p>

                <!-- Newsletter Messages -->
                <div
                  id="footer-newsletter-messages"
                  class="mil-newsletter-messages"
                  style="display: none;"
                >
                  <div
                    id="footer-newsletter-success"
                    class="mil-alert mil-alert-success"
                    style="display: none;"
                  >
                    <div class="mil-alert-content">
                      <div class="mil-alert-icon">✓</div>
                      <div class="mil-alert-text">
                        <strong>Welcome aboard!</strong>
                        <p>Check your email for a welcome message.</p>
                      </div>
                    </div>
                  </div>
                  <div
                    id="footer-newsletter-error"
                    class="mil-alert mil-alert-error"
                    style="display: none;"
                  >
                    <div class="mil-alert-content">
                      <div class="mil-alert-icon">⚠</div>
                      <div class="mil-alert-text">
                        <strong>Something went wrong!</strong>
                        <p id="footer-newsletter-error-text">
                          Please try again.
                        </p>
                      </div>
                    </div>
                  </div>
                </div>

                <form
                  id="footer-newsletter-form"
                  class="mil-subscribe-form mil-up"
                  method="POST"
                >
                  <input
                    type="email"
                    name="email"
                    placeholder="Enter your email"
                    required
                  />
                  <button
                    type="submit"
                    id="footer-newsletter-submit"
                    class="mil-button mil-icon-button-sm mil-arrow-place"
                  >
                    <span id="footer-newsletter-submit-text"> </span>
                    <span
                      id="footer-newsletter-loader"
                      class="mil-loader"
                      style="display: none;"></span>
                  </button>
                </form>
              </div>
              <div class="col-md-7 col-lg-6">
                <div class="row justify-content-end">
                  <div class="col-md-6 col-lg-7">
                    <nav class="mil-footer-menu mil-mb-60">
                      <ul>
                        {
                          navigation.footer.map((item, index) => (
                            <li
                              class={`mil-up ${index === 0 ? "mil-active" : ""}`}
                            >
                              <a href={item.url}>{item.name}</a>
                            </li>
                          ))
                        }
                      </ul>
                    </nav>
                  </div>
                  <div class="col-md-6 col-lg-5">
                    <ul class="mil-menu-list mil-up mil-mb-60">
                      {
                        navigation.legal.map((link) => (
                          <li>
                            <a href={link.url} class="mil-light-soft">
                              {link.name}
                            </a>
                          </li>
                        ))
                      }
                    </ul>
                  </div>
                </div>
              </div>
            </div>

            <div class="row justify-content-between flex-sm-row-reverse">
              <div class="col-md-7 col-lg-6">
                <div class="row justify-content-between">
                  <div class="col-md-6 col-lg-5 mil-mb-60">
                    <h6 class="mil-muted mil-up mil-mb-30">Kenya</h6>
                    <p class="mil-light-soft mil-up">
                      {company.contact.location}
                      <span class="mil-no-wrap">{company.contact.phone}</span>
                    </p>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-md-4 col-lg-6 mil-mb-60">
              <div class="mil-vert-between">
                <div class="mil-mb-30">
                  <ul class="mil-social-icons mil-up">
                    <li>
                      <a
                        href={company.socialMedia.linkedin}
                        target="_blank"
                        class="social-icon"
                        data-no-swup
                      >
                        <i class="fab fa-linkedin"></i>
                      </a>
                    </li>
                    <li>
                      <a
                        href={company.socialMedia.tiktok}
                        target="_blank"
                        class="social-icon"
                        data-no-swup
                      >
                        <i class="fab fa-tiktok"></i>
                      </a>
                    </li>
                    <li>
                      <a
                        href={company.socialMedia.instagram}
                        target="_blank"
                        class="social-icon"
                        data-no-swup
                      >
                        <i class="fab fa-instagram"></i>
                      </a>
                    </li>
                    <li>
                      <a
                        href={company.socialMedia.facebook}
                        target="_blank"
                        class="social-icon"
                        data-no-swup
                      >
                        <i class="fab fa-facebook"></i>
                      </a>
                    </li>
                  </ul>
                </div>
                <p class="mil-light-soft mil-up">
                  © Copyright <span class="copyright-year">2024</span> - All Rights
                  Reserved. {company.name}
                </p>
              </div>
            </div>
          </div>
        </div>
      </footer>
      <!-- footer end -->

      <!-- hidden elements -->
      <div class="mil-hidden-elements">
        <div class="mil-dodecahedron">
          <div class="mil-pentagon">
            <div></div><div></div><div></div><div></div><div></div>
          </div>
          <div class="mil-pentagon">
            <div></div><div></div><div></div><div></div><div></div>
          </div>
          <div class="mil-pentagon">
            <div></div><div></div><div></div><div></div><div></div>
          </div>
          <div class="mil-pentagon">
            <div></div><div></div><div></div><div></div><div></div>
          </div>
          <div class="mil-pentagon">
            <div></div><div></div><div></div><div></div><div></div>
          </div>
          <div class="mil-pentagon">
            <div></div><div></div><div></div><div></div><div></div>
          </div>
          <div class="mil-pentagon">
            <div></div><div></div><div></div><div></div><div></div>
          </div>
          <div class="mil-pentagon">
            <div></div><div></div><div></div><div></div><div></div>
          </div>
          <div class="mil-pentagon">
            <div></div><div></div><div></div><div></div><div></div>
          </div>
          <div class="mil-pentagon">
            <div></div><div></div><div></div><div></div><div></div>
          </div>
          <div class="mil-pentagon">
            <div></div><div></div><div></div><div></div><div></div>
          </div>
          <div class="mil-pentagon">
            <div></div><div></div><div></div><div></div><div></div>
          </div>
        </div>

        <svg
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 24 24"
          class="mil-arrow"
        >
          <path
            d="M 14 5.3417969 C 13.744125 5.3417969 13.487969 5.4412187 13.292969 5.6367188 L 13.207031 5.7226562 C 12.816031 6.1136563 12.816031 6.7467188 13.207031 7.1367188 L 17.070312 11 L 4 11 C 3.448 11 3 11.448 3 12 C 3 12.552 3.448 13 4 13 L 17.070312 13 L 13.207031 16.863281 C 12.816031 17.254281 12.816031 17.887344 13.207031 18.277344 L 13.292969 18.363281 C 13.683969 18.754281 14.317031 18.754281 14.707031 18.363281 L 20.363281 12.707031 C 20.754281 12.316031 20.754281 11.682969 20.363281 11.292969 L 14.707031 5.6367188 C 14.511531 5.4412187 14.255875 5.3417969 14 5.3417969 z"
          ></path>
        </svg>

        <svg
          width="250"
          viewBox="0 0 300 1404"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
          class="mil-lines"
        >
          <path
            fill-rule="evenodd"
            clip-rule="evenodd"
            d="M1 892L1 941H299V892C299 809.71 232.29 743 150 743C67.7096 743 1 809.71 1 892ZM0 942H300V892C300 809.157 232.843 742 150 742C67.1573 742 0 809.157 0 892L0 942Z"
            class="mil-move"></path>
          <path
            fill-rule="evenodd"
            clip-rule="evenodd"
            d="M299 146V97L1 97V146C1 228.29 67.7096 295 150 295C232.29 295 299 228.29 299 146ZM300 96L0 96V146C0 228.843 67.1573 296 150 296C232.843 296 300 228.843 300 146V96Z"
            class="mil-move"></path>
          <path
            fill-rule="evenodd"
            clip-rule="evenodd"
            d="M299 1H1V1403H299V1ZM0 0V1404H300V0H0Z"></path>
          <path
            fill-rule="evenodd"
            clip-rule="evenodd"
            d="M150 -4.37115e-08L150 1404L149 1404L149 0L150 -4.37115e-08Z"
          ></path>
          <path
            fill-rule="evenodd"
            clip-rule="evenodd"
            d="M150 1324C232.29 1324 299 1257.29 299 1175C299 1092.71 232.29 1026 150 1026C67.7096 1026 1 1092.71 1 1175C1 1257.29 67.7096 1324 150 1324ZM150 1325C232.843 1325 300 1257.84 300 1175C300 1092.16 232.843 1025 150 1025C67.1573 1025 0 1092.16 0 1175C0 1257.84 67.1573 1325 150 1325Z"
            class="mil-move"></path>
          <path
            fill-rule="evenodd"
            clip-rule="evenodd"
            d="M300 1175H0V1174H300V1175Z"
            class="mil-move"></path>
          <path
            fill-rule="evenodd"
            clip-rule="evenodd"
            d="M150 678C232.29 678 299 611.29 299 529C299 446.71 232.29 380 150 380C67.7096 380 1 446.71 1 529C1 611.29 67.7096 678 150 678ZM150 679C232.843 679 300 611.843 300 529C300 446.157 232.843 379 150 379C67.1573 379 0 446.157 0 529C0 611.843 67.1573 679 150 679Z"
            class="mil-move"></path>
          <path
            fill-rule="evenodd"
            clip-rule="evenodd"
            d="M299 380H1V678H299V380ZM0 379V679H300V379H0Z"
            class="mil-move"></path>
        </svg>
      </div>
      <!-- hidden elements end -->
    </div>
    <!-- wrapper end -->

    <!-- Scripts -->
    <script src="/js/plugins/jquery.min.js" is:inline></script>
    <script src="/js/plugins/swup.min.js" is:inline></script>
    <script src="/js/plugins/swiper.min.js" is:inline></script>
    <script src="/js/plugins/fancybox.min.js" is:inline></script>
    <script src="/js/plugins/gsap.min.js" is:inline></script>
    <script src="/js/plugins/smooth-scroll.js" is:inline></script>
    <script src="/js/plugins/ScrollTrigger.min.js" is:inline></script>
    <script src="/js/plugins/ScrollTo.min.js" is:inline></script>
    <script src="/js/main.js" is:inline></script>

    <!-- Newsletter Styles -->
    <style>
      /* Newsletter Alert Styles */
      .mil-newsletter-messages {
        margin-bottom: 20px;
      }

      .mil-alert {
        border-radius: 8px;
        padding: 16px;
        margin-bottom: 16px;
        border-left: 4px solid;
        animation: slideDown 0.3s ease-out;
      }

      .mil-alert-success {
        background-color: rgba(16, 185, 129, 0.1);
        border-left-color: #10b981;
        color: #065f46;
      }

      .mil-alert-error {
        background-color: rgba(239, 68, 68, 0.1);
        border-left-color: #ef4444;
        color: #991b1b;
      }

      .mil-alert-content {
        display: flex;
        align-items: flex-start;
        gap: 12px;
      }

      .mil-alert-icon {
        font-size: 18px;
        font-weight: bold;
        margin-top: 2px;
      }

      .mil-alert-success .mil-alert-icon {
        color: #10b981;
      }

      .mil-alert-error .mil-alert-icon {
        color: #ef4444;
      }

      .mil-alert-text strong {
        display: block;
        margin-bottom: 4px;
        font-size: 14px;
      }

      .mil-alert-text p {
        margin: 0;
        font-size: 13px;
        opacity: 0.9;
      }

      .mil-loader {
        display: inline-block;
        width: 12px;
        height: 12px;
        border: 2px solid rgba(255, 255, 255, 0.3);
        border-top: 2px solid #ffffff;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
      }

      /* Blog page loader */
      .mil-soft-bg .mil-loader {
        border: 2px solid rgba(0, 0, 0, 0.1);
        border-top: 2px solid #ff9800;
      }

      .mil-subscribe-form button:disabled {
        opacity: 0.7;
        cursor: not-allowed;
      }

      .mil-subscribe-form button {
        position: relative;
      }

      .mil-arrow-icon {
        display: inline-block;
      }

      /* Ensure footer newsletter form button is properly positioned */
      #footer-newsletter-form.mil-subscribe-form {
        position: relative;
        height: 70px;
      }

      #footer-newsletter-form.mil-subscribe-form .mil-button {
        position: absolute;
        top: 15px;
        right: 15px;
        z-index: 2;
        min-width: 40px;
        min-height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      #footer-newsletter-form.mil-subscribe-form input {
        padding-right: 60px;
      }

      /* Arrow icon for submit button */
      .mil-arrow-icon::after {
        content: "→";
        font-size: 16px;
        font-weight: bold;
      }

      /* Footer specific styles */
      footer .mil-alert {
        background-color: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        border-left-color: #ff9800;
      }

      footer .mil-alert-success {
        color: #ffffff;
      }

      footer .mil-alert-error {
        color: #ffffff;
      }

      footer .mil-alert-success .mil-alert-icon {
        color: #10b981;
      }

      footer .mil-alert-error .mil-alert-icon {
        color: #ef4444;
      }

      @keyframes slideDown {
        from {
          opacity: 0;
          transform: translateY(-10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
    </style>

    <!-- Newsletter JavaScript -->
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // Footer Newsletter
        setupNewsletterForm("footer");

        // Blog Newsletter (if exists)
        setupNewsletterForm("blog");

        function setupNewsletterForm(prefix: string) {
          const form = document.getElementById(
            `${prefix}-newsletter-form`
          ) as HTMLFormElement;
          const submitBtn = document.getElementById(
            `${prefix}-newsletter-submit`
          ) as HTMLButtonElement;
          const loader = document.getElementById(`${prefix}-newsletter-loader`);
          const messages = document.getElementById(
            `${prefix}-newsletter-messages`
          );
          const successMsg = document.getElementById(
            `${prefix}-newsletter-success`
          );
          const errorMsg = document.getElementById(
            `${prefix}-newsletter-error`
          );
          const errorText = document.getElementById(
            `${prefix}-newsletter-error-text`
          );

          if (!form) return;

          form.addEventListener("submit", async (e) => {
            e.preventDefault();

            // Clear previous messages
            hideMessages();

            // Show loading state
            setLoadingState(true);

            // Get form data
            if (!form) return;

            const formData = new FormData(form);
            const email = formData.get("email") as string;

            // Validate email
            if (!email || !isValidEmail(email)) {
              showError("Please enter a valid email address.");
              setLoadingState(false);
              return;
            }

            try {
              const response = await fetch("/api/newsletter", {
                method: "POST",
                body: formData,
              });

              const result = await response.json();

              if (response.ok && result.success) {
                showSuccess();
                if (form) {
                  form.reset();
                }
              } else if (response.status === 409 && result.duplicate) {
                showError(
                  "You are already subscribed! Thanks for being part of our community."
                );
              } else {
                showError(
                  result.error || "Failed to subscribe. Please try again."
                );
              }
            } catch (error) {
              console.error("Newsletter subscription error:", error);
              showError(
                "Network error. Please check your connection and try again."
              );
            } finally {
              setLoadingState(false);
            }
          });

          function isValidEmail(email: string) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return emailRegex.test(email);
          }

          function setLoadingState(loading: boolean) {
            if (submitBtn && loader) {
              submitBtn.disabled = loading;

              const arrowIcon = submitBtn.querySelector(
                ".mil-arrow-icon"
              ) as HTMLElement;
              if (arrowIcon && loader) {
                arrowIcon.style.display = loading ? "none" : "inline-block";
                loader.style.display = loading ? "inline-block" : "none";
              }
            }
          }

          function showSuccess() {
            if (messages && successMsg && errorMsg) {
              messages.style.display = "block";
              successMsg.style.display = "block";
              errorMsg.style.display = "none";

              // Auto hide after 5 seconds
              setTimeout(() => {
                hideMessages();
              }, 5000);
            }
          }

          function showError(message: string) {
            if (messages && errorMsg && errorText && successMsg) {
              messages.style.display = "block";
              errorMsg.style.display = "block";
              successMsg.style.display = "none";
              errorText.textContent = message;

              // Auto hide after 5 seconds
              setTimeout(() => {
                hideMessages();
              }, 5000);
            }
          }

          function hideMessages() {
            if (messages && successMsg && errorMsg) {
              messages.style.display = "none";
              successMsg.style.display = "none";
              errorMsg.style.display = "none";
            }
          }
        }
      });
    </script>
  </body>
</html>
